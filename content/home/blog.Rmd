---
title: "Recent Posts"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```
```{css}
/* Posts grid styling */
.posts-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin: 20px 0;
  max-width: 900px;
}

.post-card {
  border: 1px solid rgba(0,0,0,0.08);
  padding: 10px;
  border-radius: 12px;
  background: rgba(35, 138, 141, 0.06);
  transition: transform 0.2s, box-shadow 0.2s;
}

.post-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 4px 12px rgba(35, 138, 141, 0.2);
}

.post-card h3 {
  margin-top: 0;
  margin-bottom: 8px;
  font-size: 3rem;
  line-height: 1.3;
  font-weight: 600;
  color: #111;
}

.post-card h3 a {
  color: #238A8D;
  text-decoration: none;
}

.post-card h3 a:hover {
  text-decoration: underline;
}

.post-date {
  color: #666;
  font-size: 0.85em;
  margin-bottom: 8px;
  margin-top: 0;
  font-weight: 500;
}

.post-excerpt {
  color: #444;
  line-height: 1.5;
  font-size: 0.95em;
  margin-top: 0;
}

@media (max-width: 768px) {
  .posts-grid {
    grid-template-columns: 1fr;
  }
}
```

```{r generate-posts, results='asis'}
# List all markdown files in content/post directory
post_files <- list.files("/post/", pattern = "\\.Rmd$", full.names = TRUE)

# Function to extract metadata from YAML frontmatter
extract_metadata <- function(file) {
  lines <- readLines(file, warn = FALSE)
  
  # Find YAML frontmatter boundaries
  yaml_start <- which(lines == "---")[1]
  yaml_end <- which(lines == "---")[2]
  
  if (is.na(yaml_start) || is.na(yaml_end)) {
    return(NULL)
  }
  
  yaml_lines <- lines[(yaml_start + 1):(yaml_end - 1)]
  
  # Extract title
  title_line <- yaml_lines[grep("^title:", yaml_lines)]
  title <- if (length(title_line) > 0) {
    gsub("title:\\s*['\"]?|['\"]?$", "", title_line[1])
  } else {
    "Untitled Post"
  }
  
  # Extract date
  date_line <- yaml_lines[grep("^date:", yaml_lines)]
  date <- if (length(date_line) > 0) {
    gsub("date:\\s*['\"]?|['\"]?$", "", date_line[1])
  } else {
    "No date"
  }
  
  # Extract excerpt/summary if available
  summary_line <- yaml_lines[grep("^summary:|^excerpt:", yaml_lines)]
  excerpt <- if (length(summary_line) > 0) {
    gsub("summary:\\s*['\"]?|excerpt:\\s*['\"]?|['\"]?$", "", summary_line[1])
  } else {
    # Get first non-empty paragraph after YAML as excerpt
    content_lines <- lines[(yaml_end + 1):length(lines)]
    content_lines <- trimws(content_lines)
    content_lines <- content_lines[nzchar(content_lines)]
    
    if (length(content_lines) > 0) {
      for (line in content_lines) {
        clean_line <- gsub("^#+\\s*", "", line)
        clean_line <- gsub("\\[([^]]+)\\]\\([^)]+\\)", "\\1", clean_line)
        clean_line <- gsub("\\*\\*|__", "", clean_line)
        clean_line <- gsub("\\*|_", "", clean_line)
        clean_line <- trimws(clean_line)
        
        if (nchar(clean_line) > 20) {
          excerpt <- substr(clean_line, 1, 150)
          break
        }
      }
      
      if (!exists("excerpt")) {
        excerpt <- substr(content_lines[1], 1, 150)
      }
      excerpt
    } else {
      "Click to read more..."
    }
  }
  
  if (is.null(excerpt) || excerpt == "" || is.na(excerpt)) {
    excerpt <- "Click to read more..."
  }
  
  # Path to HTML file in docs output
  html_file <- paste0("/post/", gsub("\\.Rmd$", ".html", basename(file)))
  
  list(
    title = title,
    date = date,
    excerpt = excerpt,
    file = html_file,
    sort_date = tryCatch(as.Date(date, format = "%Y-%m-%d"), error = function(e) Sys.Date())
  )
}

# Extract metadata from all posts
posts <- lapply(post_files, extract_metadata)
posts <- posts[!sapply(posts, is.null)]

# Sort by date (newest first)
posts <- posts[order(sapply(posts, function(x) x$sort_date), decreasing = TRUE)]

# Generate HTML
cat('<div class="posts-grid">\n\n')

for (post in posts) {
  cat(sprintf('
<div class="post-card">

### [%s](%s)

<div class="post-date">%s</div>

<div class="post-excerpt">%s...</div>

</div>

', post$title, post$file, post$date, post$excerpt))
}

cat('\n</div>\n')
```
